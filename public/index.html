<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Best Cart Deal Calculator</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 40px;
            padding: 25px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            background: #fafafa;
        }
        
        .section h3 {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        
        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus, input[type="number"]:focus {
            outline: none;
            border-color: #2196F3;
        }
        
        .btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn:hover {
            background: #1976D2;
            transform: translateY(-2px);
        }
        
        .btn-add {
            background: #4CAF50;
        }
        
        .btn-add:hover {
            background: #45a049;
        }
        
        .btn-remove {
            background: #f44336;
            padding: 8px 12px;
            font-size: 14px;
        }
        
        .btn-remove:hover {
            background: #d32f2f;
        }
        
        .btn-calculate {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            font-size: 18px;
            padding: 15px 30px;
            margin: 20px 0;
            width: 100%;
        }
        
        .btn-calculate:hover {
            background: linear-gradient(45deg, #FF5252, #FF7043);
        }
        
        .item-row, .vendor-section {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        
        .item-row input {
            flex: 1;
        }
        
        .vendor-section {
            flex-direction: column;
            align-items: stretch;
        }
        
        .vendor-header {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .vendor-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .vendor-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .vendor-item span {
            min-width: 80px;
            font-weight: 500;
        }
        
        .result {
            margin-top: 30px;
            padding: 25px;
            border-radius: 10px;
            display: none;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result.success {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border: 2px solid #28a745;
            color: #155724;
        }
        
        .result.error {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            border: 2px solid #dc3545;
            color: #721c24;
        }
        
        .result-header {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .result-content {
            font-size: 1.1em;
            line-height: 1.6;
        }
        
        .selection-list {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.3);
            border-radius: 8px;
        }
        
        .loading {
            display: none;
            text-align: center;
            color: #2196F3;
            font-size: 1.2em;
            margin: 20px 0;
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2196F3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõí Best Cart Deal Calculator</h1>
            <p>Find the cheapest way to buy your items across multiple vendors!</p>
        </div>
        
        <div class="content">
            <!-- Shopping Cart Items Section -->
            <div class="section">
                <h3>üõçÔ∏è Shopping Cart Items</h3>
                <div id="cartItems">
                    <div class="item-row">
                        <input type="text" placeholder="Enter item name..." value="Laptop">
                        <button class="btn btn-remove" onclick="removeCartItem(this)">‚ùå</button>
                    </div>
                    <div class="item-row">
                        <input type="text" placeholder="Enter item name..." value="Mouse">
                        <button class="btn btn-remove" onclick="removeCartItem(this)">‚ùå</button>
                    </div>
                    <div class="item-row">
                        <input type="text" placeholder="Enter item name..." value="Keyboard">
                        <button class="btn btn-remove" onclick="removeCartItem(this)">‚ùå</button>
                    </div>
                </div>
                <button class="btn btn-add" onclick="addCartItem()">‚ûï Add Item</button>
            </div>
            
            <!-- Vendors Section -->
            <div class="section">
                <h3>üè™ Vendors</h3>
                <div id="vendors">
                    <!-- Vendor 1 -->
                    <div class="vendor-section">
                        <div class="vendor-header">
                            <input type="text" placeholder="Vendor name..." value="TechStore" style="flex: 2;">
                            <input type="number" placeholder="Shipping fee..." value="20" style="flex: 1;" min="0" step="0.01">
                            <button class="btn btn-remove" onclick="removeVendor(this)">‚ùå</button>
                        </div>
                        <div class="vendor-items"></div>
                    </div>
                    
                    <!-- Vendor 2 -->
                    <div class="vendor-section">
                        <div class="vendor-header">
                            <input type="text" placeholder="Vendor name..." value="ElectroMart" style="flex: 2;">
                            <input type="number" placeholder="Shipping fee..." value="15" style="flex: 1;" min="0" step="0.01">
                            <button class="btn btn-remove" onclick="removeVendor(this)">‚ùå</button>
                        </div>
                        <div class="vendor-items"></div>
                    </div>
                </div>
                <button class="btn btn-add" onclick="addVendor()">üè™ Add Vendor</button>
            </div>
            
            <!-- Calculate Button -->
            <button class="btn btn-calculate" onclick="calculateBestDeal()">
                üßÆ Calculate Best Deal
            </button>
            
            <!-- Loading Animation -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                Calculating the best deal for you...
            </div>
            
            <!-- Results Section -->
            <div class="result" id="result">
                <div class="result-header" id="resultHeader"></div>
                <div class="result-content" id="resultContent"></div>
            </div>
        </div>
    </div>

    <script>
        // API endpoint - Replace with your Render backend URL
        const API_URL = 'https://your-render-app-name.onrender.com/best-deal';
        
        /**
         * Add a new cart item input field
         */
        function addCartItem() {
            const cartItems = document.getElementById('cartItems');
            const itemRow = document.createElement('div');
            itemRow.className = 'item-row';
            itemRow.innerHTML = `
                <input type="text" placeholder="Enter item name...">
                <button class="btn btn-remove" onclick="removeCartItem(this)">‚ùå</button>
            `;
            cartItems.appendChild(itemRow);
            updateVendorItems();
        }
        
        /**
         * Remove a cart item
         */
        function removeCartItem(button) {
            button.parentElement.remove();
            updateVendorItems();
        }
        
        /**
         * Add a new vendor section
         */
        function addVendor() {
            const vendors = document.getElementById('vendors');
            const vendorSection = document.createElement('div');
            vendorSection.className = 'vendor-section';
            vendorSection.innerHTML = `
                <div class="vendor-header">
                    <input type="text" placeholder="Vendor name..." style="flex: 2;">
                    <input type="number" placeholder="Shipping fee..." min="0" step="0.01" style="flex: 1;">
                    <button class="btn btn-remove" onclick="removeVendor(this)">‚ùå</button>
                </div>
                <div class="vendor-items"></div>
            `;
            vendors.appendChild(vendorSection);
            updateVendorItems();
        }
        
        /**
         * Remove a vendor
         */
        function removeVendor(button) {
            button.closest('.vendor-section').remove();
        }
        
        /**
         * Update vendor item price inputs based on cart items
         */
        function updateVendorItems() {
            // Get all cart items
            const cartInputs = document.querySelectorAll('#cartItems input[type="text"]');
            const items = Array.from(cartInputs).map(input => input.value.trim()).filter(item => item);
            
            // Update each vendor's item inputs
            const vendorSections = document.querySelectorAll('.vendor-section');
            vendorSections.forEach(section => {
                const vendorItems = section.querySelector('.vendor-items');
                const existingInputs = {};
                
                // Save existing values
                const existingPriceInputs = vendorItems.querySelectorAll('input[type="number"]');
                existingPriceInputs.forEach(input => {
                    const itemName = input.previousElementSibling.textContent;
                    existingInputs[itemName] = input.value;
                });
                
                // Clear and rebuild
                vendorItems.innerHTML = '';
                
                items.forEach(item => {
                    const vendorItem = document.createElement('div');
                    vendorItem.className = 'vendor-item';
                    vendorItem.innerHTML = `
                        <span>${item}:</span>
                        <input type="number" placeholder="Price" min="0" step="0.01" value="${existingInputs[item] || ''}">
                    `;
                    vendorItems.appendChild(vendorItem);
                });
            });
        }
        
        /**
         * Collect form data and convert to API format
         */
        function collectFormData() {
            // Get cart items
            const cartInputs = document.querySelectorAll('#cartItems input[type="text"]');
            const cart = Array.from(cartInputs)
                .map(input => input.value.trim())
                .filter(item => item);
            
            if (cart.length === 0) {
                throw new Error('Please add at least one item to your cart');
            }
            
            // Get vendors
            const vendors = [];
            const vendorSections = document.querySelectorAll('.vendor-section');
            
            vendorSections.forEach(section => {
                const nameInput = section.querySelector('.vendor-header input[type="text"]');
                const shippingInput = section.querySelector('.vendor-header input[type="number"]');
                
                const name = nameInput.value.trim();
                const shipping = parseFloat(shippingInput.value) || 0;
                
                if (!name) return; // Skip vendors without names
                
                const items = {};
                const itemInputs = section.querySelectorAll('.vendor-items input[type="number"]');
                itemInputs.forEach(input => {
                    const itemName = input.previousElementSibling.textContent.replace(':', '');
                    const price = parseFloat(input.value);
                    if (!isNaN(price) && price >= 0) {
                        items[itemName] = price;
                    }
                });
                
                vendors.push({ name, shipping, items });
            });
            
            if (vendors.length === 0) {
                throw new Error('Please add at least one vendor with prices');
            }
            
            // Check if all cart items have at least one vendor price
            for (const item of cart) {
                const hasPrice = vendors.some(vendor => vendor.items[item] !== undefined);
                if (!hasPrice) {
                    throw new Error(`Item "${item}" has no price from any vendor`);
                }
            }
            
            return { cart, vendors };
        }
        
        /**
         * Calculate the best deal
         */
        async function calculateBestDeal() {
            const resultDiv = document.getElementById('result');
            const resultHeader = document.getElementById('resultHeader');
            const resultContent = document.getElementById('resultContent');
            const loading = document.getElementById('loading');
            const calculateBtn = document.querySelector('.btn-calculate');
            
            // Hide previous results and show loading
            resultDiv.style.display = 'none';
            loading.style.display = 'block';
            calculateBtn.disabled = true;
            
            try {
                // Collect and validate form data
                const data = collectFormData();
                
                // Make API call with better error handling
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                // Check if response is ok before trying to parse JSON
                if (!response.ok) {
                    // Try to get error message from response
                    let errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.error || errorMessage;
                    } catch (e) {
                        // If JSON parsing fails, use the HTTP status message
                    }
                    throw new Error(errorMessage);
                }
                
                // Check if response has content
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    throw new Error('Server did not return JSON response');
                }
                
                const result = await response.json();
                
                // Display success result
                resultDiv.className = 'result success';
                resultHeader.innerHTML = 'üéâ Best Deal Found!';
                
                let content = `
                    <div style="font-size: 1.3em; font-weight: bold; margin-bottom: 10px;">
                        üí∞ Cheapest Total: $${result.cheapest_total.toFixed(2)}
                    </div>
                `;
                
                content += '<div class="selection-list">';
                content += '<strong>üì¶ Vendor Selection:</strong><br>';
                
                for (const [item, vendor] of Object.entries(result.selection)) {
                    content += `<div style="margin: 5px 0;">‚Ä¢ ${item} ‚Üí ${vendor}</div>`;
                }
                
                content += '</div>';
                
                resultContent.innerHTML = content;
                resultDiv.style.display = 'block';
                
            } catch (error) {
                // Display error with more details
                resultDiv.className = 'result error';
                resultHeader.innerHTML = '‚ùå Error';
                
                let errorMessage = error.message;
                if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    errorMessage = 'Cannot connect to the backend server. Please check if the Render backend is running and the URL is correct.';
                }
                
                resultContent.innerHTML = `<strong>Error:</strong> ${errorMessage}`;
                resultDiv.style.display = 'block';
                
                console.error('Error:', error);
            } finally {
                // Hide loading and re-enable button
                loading.style.display = 'none';
                calculateBtn.disabled = false;
            }
        }
        
        // Initialize vendor items when page loads
        window.addEventListener('load', function() {
            updateVendorItems();
            
            // Add some example prices
            const vendorSections = document.querySelectorAll('.vendor-section');
            if (vendorSections.length >= 2) {
                // TechStore prices
                const techStoreInputs = vendorSections[0].querySelectorAll('.vendor-items input[type="number"]');
                if (techStoreInputs.length >= 3) {
                    techStoreInputs[0].value = '899'; // Laptop
                    techStoreInputs[1].value = '35';  // Mouse
                    techStoreInputs[2].value = '75';  // Keyboard
                }
                
                // ElectroMart prices
                const electroInputs = vendorSections[1].querySelectorAll('.vendor-items input[type="number"]');
                if (electroInputs.length >= 3) {
                    electroInputs[0].value = '950'; // Laptop
                    electroInputs[1].value = '28';  // Mouse
                    electroInputs[2].value = '65';  // Keyboard
                }
            }
        });
        
        // Update vendor items when cart items change
        document.getElementById('cartItems').addEventListener('input', function(e) {
            if (e.target.type === 'text') {
                setTimeout(updateVendorItems, 100); // Small delay to allow input to update
            }
        });
    </script>
</body>
</html>